<?xml version="1.0" encoding="UTF-8" ?>

<beans xmlns="http://www.springframework.org/schema/beans"
        
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
                           http://www.springframework.org/schema/beans/spring-beans.xsd         
                           http://camel.apache.org/schema/spring 
                           http://camel.apache.org/schema/spring/camel-spring.xsd          
                           http://camel.apache.org/schema/cxf 
                           http://camel.apache.org/schema/cxf/camel-cxf.xsd" >  
    
    <camelContext id="_idFlujoCamelContext" streamCache="true" xmlns="http://camel.apache.org/schema/spring" >
    
        <propertyPlaceholder id="_idPlaceholder" location="classpath:application.properties" />
         
        <route id="_idFlujoCamelRoute" streamCache="true" > 
        
            <from id="_File_001" uri="{{ws.file.component}}" />    
             
            <doTry id="_idDoTry_01" >
                <log id="_Log_01" message="EJECUTANDO 'file' INPUT... \n ${body}" />         
 
                <setProperty propertyName="vOpcionTransf" >
                   <simple>{{ws.file.msj.opcion}}</simple>
                </setProperty>
                
                <log id="_Log_02" message="OPCION: \n [${property.vOpcionTransf}]" /> 
      
                <!-- PROCESANDO OPCIONES DE 'TRANSFORMACION' -->
                <choice>    
					<when id="_idWhen_01" >
					    <simple>${property.vOpcionTransf} == '1'</simple>
						
						<to  id="_idTo_01" uri="xslt:xslt/{{ws.file.transf.html}}" />
						<log id="_Log_03"  message="Procesando Transformacion: 'HTML'..." />
						<to  id="_idTo_02" uri="file:OUTPUT?fileName={{ws.file.msj.html.output}}" />  
					</when>
					 
		            <when id="_idWhen_02" >
						<simple>${property.vOpcionTransf} == '2'</simple>
					    
		                <to  id="_idTo_03" uri="xslt:xslt/{{ws.file.transf.xml}}" />
						<log id="_Log_04"  message="Procesando Transformacion: 'XML'..." />
						<to  id="_idTo_04" uri="file:OUTPUT?fileName={{ws.file.msj.xml.output}}" />  
		            </when>
		            <when id="_idWhen_03" >
						<simple>${property.vOpcionTransf} == '3'</simple>
						
			            <to  id="_idTo_05" uri="xslt:xslt/{{ws.file.transf.json}}" />
						<log id="_Log_05"  message="Procesando Transformacion: 'JSON'..." />
						<to  id="_idTo_06" uri="file:OUTPUT?fileName={{ws.file.msj.json.output}}" />  
		            </when>
		            <when id="_idWhen_04" >
						<simple>${property.vOpcionTransf} == '4'</simple>
						
		                <to  id="_idTo_07" uri="xslt:xslt/{{ws.file.transf.txt}}" />
						<log id="_Log_06"  message="Procesando Transformacion: 'TXT'..." />
						<to  id="_idTo_08" uri="file:OUTPUT?fileName={{ws.file.msj.txt.output}}" />  
		            </when>
		                 
		            <otherwise>
						<log id="_Log_07"  message="NO existe OPCION de la Transformacion ..." />  
		            </otherwise>
				</choice>
				         
                <log id="_Log_03" message="OUTPUT...  \n ${body}" />                           
                                           
                <doCatch id="_idDoCatch_01" >
                    <exception>java.lang.Exception</exception>  
                    
                    <handled>
                       <constant>true</constant>
                    </handled>
                    
                    <setBody id="_idSetBody_02" >  
                        <simple>${exception.getResponseBody}</simple>
                    </setBody>
                    
                    <log id="_Log_07" message="Exception: \n ${body}" />    
                </doCatch>
            </doTry>
            
        </route>
        
    </camelContext>
 
</beans>

